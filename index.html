<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FlowerFit: Flowers for Your Climate & Colors</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      /* Add a subtle background image here */
      background-image: url('flower-background.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed; /* Makes the background stay in place */
      color: #4b5563; /* Change default text color for better readability on the background */
      position: relative; /* Needed for the overlay to work */
      z-index: 0;
    }
    /* Creates an opaque overlay over the background image */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7); /* White overlay with 70% opacity */
      z-index: -1;
    }
    /*
      Custom styling for the button to add a bit more pop
    */
    button:not(.close-btn) {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.2s;
    }
    button:not(.close-btn):hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .tag {
        font-weight: bold;
    }
  </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">
  <div class="max-w-4xl w-full mx-auto p-8 bg-white rounded-xl shadow-2xl space-y-8">

    <!-- Mission Statement Section -->
    <header class="text-center">
      <h1 class="text-5xl font-extrabold text-blue-800">FlowerFit üå∏</h1>
      <p class="mt-2 text-xl text-gray-600">Cultivating Gardens, Sowing Social Good</p>
    </header>

    <section class="bg-blue-50 p-6 rounded-lg border-l-4 border-blue-500">
      <h2 class="text-2xl font-bold text-blue-700">Our Mission for Social Good</h2>
      <p class="mt-2 text-gray-700">
        Our project aims to address critical environmental issues by helping gardeners make informed, sustainable choices. By suggesting plants suited to your local climate, we contribute to:
      </p>
      <ul class="list-disc list-inside mt-4 text-gray-700 space-y-2">
        <li>
          <span class="font-semibold text-green-600">Protecting Pollinators:</span> We recommend pollinator-friendly flowers, helping to restore habitats for bees and butterflies.
        </li>
        <li>
          <span class="font-semibold text-sky-600">Conserving Water:</span> We reduce water waste by promoting drought-resistant and climate-appropriate plants.
        </li>
        <li>
          <span class="font-semibold text-gray-600">Reducing Garden Waste:</span> We increase planting success and reduce waste by guiding you to plants that thrive naturally in your area.
        </li>
        <li>
          <span class="font-semibold text-amber-600">Fostering Biodiversity:</span> We encourage the use of native species to support local ecosystems and biodiversity.
        </li>
      </ul>
    </section>

    <!-- Location Block -->
    <div class="card p-6 bg-white rounded-lg shadow-md">
      <h2 class="text-2xl font-semibold text-gray-800">1. Your Location / Climate Zone</h2>
      <p class="mt-4 text-gray-600">
        <button id="detect-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">Use My Location</button>
        <span class="text-gray-500 mx-4">or enter ZIP:</span>
        <input id="zip" placeholder="e.g. 90210" class="border border-gray-300 rounded-lg p-2 w-32 focus:border-blue-500 focus:ring-blue-500" />
        <button id="lookup-zip" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">Lookup</button>
      </p>
      <p id="zone-info" class="mt-4 text-xl font-medium">Zone: <em class="text-red-500 font-bold">unknown</em></p>
      <div id="error-message" class="text-red-500 mt-2 hidden"></div>
      <p class="text-sm text-gray-500 mt-2">Hardiness zones help determine plants that survive winter lows. <a href="https://planthardiness.ars.usda.gov/" target="_blank" class="text-blue-500 hover:underline">See USDA map</a>.</p>
    </div>

    <!-- Flowers Block -->
    <div class="card p-6 bg-white rounded-lg shadow-md hidden" id="flowers-block">
      <h2 class="text-2xl font-semibold text-gray-800">2. Recommended Flowers</h2>
      <p class="mt-4 text-gray-600">Based on your zone, these are great sustainable picks:</p>
      <ul class="flower-list list-none p-0 mt-4 space-y-4" id="flower-list"></ul>
      <div class="flex items-center space-x-2 mt-6">
        <span class="text-sm font-semibold text-gray-700">Can't find what you're looking for?</span>
        <button id="generate-new-flower" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">Suggest a New Flower</button>
      </div>
      <div id="new-flower-loader" class="mt-4 flex items-center space-x-2 hidden">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"></div>
        <span class="text-gray-500">Generating suggestion...</span>
      </div>
    </div>

    <!-- Color Schemes Block -->
    <div class="card p-6 bg-white rounded-lg shadow-md hidden" id="colors-block">
      <h2 class="text-2xl font-semibold text-gray-800">3. Color Scheme Suggestions</h2>
      <p class="mt-4 text-gray-600">Pick a style that fits your aesthetic:</p>
      <div class="grid md:grid-cols-3 gap-6 mt-6">
        <div>
          <strong class="text-gray-700">Complementary</strong>
          <div class="palette flex gap-2 mt-2" id="comp-palette"></div>
        </div>
        <div>
          <strong class="text-gray-700">Analogous</strong>
          <div class="palette flex gap-2 mt-2" id="analog-palette"></div>
        </div>
        <div>
          <strong class="text-gray-700">Dominant / Secondary / Accent</strong>
          <div class="palette flex gap-2 mt-2" id="rule-palette"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Messages -->
  <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <div class="mt-3 text-center">
        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"></h3>
        <div class="mt-2 px-7 py-3">
          <p class="text-sm text-gray-500" id="modal-content"></p>
        </div>
        <div class="items-center px-4 py-3">
          <button id="close-modal" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 close-btn">
            OK
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // A simple function to show the modal with a title and message
    function showModal(title, message) {
      document.getElementById('modal-title').innerText = title;
      document.getElementById('modal-content').innerText = message;
      document.getElementById('message-modal').style.display = 'block';
    }

    // Event listener to close the modal
    document.getElementById('close-modal').addEventListener('click', () => {
      document.getElementById('message-modal').style.display = 'none';
    });

    // The core logic of the FlowerFit app
    document.addEventListener('DOMContentLoaded', () => {
      // Demo data updated with social good tags
      const zipToZone = {
        '902': '10b', // southern California
        '100': '7b', // NYC
        '606': '6a', // Chicago
        '733': '8b', // Austin-ish
      };

      const zoneFlowers = {
        '10b': [
          { name: 'Lantana', color: 'pink/orange', notes: 'Heat tolerant', water: 'low', pollinator: true, native: false },
          { name: 'California Poppy', color: 'orange', notes: 'Drought tolerant', water: 'low', pollinator: true, native: true },
          { name: 'Salvia', color: 'blue', notes: 'Attracts pollinators', water: 'medium', pollinator: true, native: false }
        ],
        '7b': [
          { name: 'Coneflower', color: 'purple', notes: 'Perennial, drought tolerant', water: 'low', pollinator: true, native: true },
          { name: 'Bee Balm', color: 'red/pink', notes: 'Attracts bees and hummingbirds', water: 'medium', pollinator: true, native: true },
          { name: 'Daylily', color: 'yellow', notes: 'Low maintenance', water: 'low', pollinator: false, native: false }
        ],
        '6a': [
          { name: 'Peony', color: 'pink/white', notes: 'Cold resistant', water: 'medium', pollinator: false, native: false },
          { name: 'Black-eyed Susan', color: 'gold', notes: 'Long bloom', water: 'low', pollinator: true, native: true },
          { name: 'Aster', color: 'purple/white', notes: 'Late season food source for pollinators', water: 'medium', pollinator: true, native: true }
        ],
        '8b': [
          { name: 'Angelonia', color: 'lavender', notes: 'Summer bloom', water: 'medium', pollinator: false, native: false },
          { name: 'Yarrow', color: 'white/yellow', notes: 'Drought tolerant, attracts beneficial insects', water: 'low', pollinator: true, native: true },
          { name: 'Snapdragon', color: 'mixed', notes: 'Full sun', water: 'medium', pollinator: false, native: false }
        ]
      };

      let currentZone = null;

      function showFlowers(zone) {
        const list = document.getElementById('flower-list');
        list.innerHTML = '';
        const flowers = zoneFlowers[zone] || [];
        if (!flowers.length) {
          list.innerHTML = '<li class="text-gray-500">No sample data for this zone yet.</li>';
        } else {
          flowers.forEach(f => {
            const li = document.createElement('li');
            li.className = 'border-b pb-4';
            let tags = [];
            if (f.pollinator) tags.push('<span class="tag bg-green-200 text-green-800">üêù Pollinator-Friendly</span>');
            if (f.native) tags.push('<span class="tag bg-blue-200 text-blue-800">üåé Native Plant</span>');
            if (f.water === 'low') tags.push('<span class="tag bg-sky-200 text-sky-800">üíß Low Water Needs</span>');
            else if (f.water === 'medium') tags.push('<span class="tag bg-yellow-200 text-yellow-800">üíß Medium Water Needs</span>');
            
            li.innerHTML = `
              <div class="flex items-center space-x-2">
                <strong class="text-xl text-blue-800">${f.name}</strong>
                <span class="text-gray-600">(${f.color})</span>
              </div>
              <p class="mt-1 text-gray-500">${f.notes}</p>
              <div class="mt-2 flex flex-wrap gap-2">
                ${tags.join('')}
              </div>
            `;
            list.appendChild(li);
          });
        }
        document.getElementById('flowers-block').classList.remove('hidden');
      }

      function setZone(zone) {
        currentZone = zone;
        document.getElementById('zone-info').innerHTML = `Zone: <em class="text-blue-600 font-bold">${zone}</em>`;
        showFlowers(zone);
        generatePalettes();
        document.getElementById('colors-block').classList.remove('hidden');
      }

      document.getElementById('lookup-zip').onclick = () => {
        const raw = document.getElementById('zip').value.trim();
        const prefix = raw.slice(0, 3);
        const zone = zipToZone[prefix];
        if (zone) {
          setZone(zone);
          document.getElementById('error-message').classList.add('hidden');
        } else {
          document.getElementById('error-message').classList.remove('hidden');
          document.getElementById('error-message').innerText = 'Please enter a valid sample ZIP code prefix (e.g., 902, 100, 606, 733).';
        }
      };

      document.getElementById('detect-btn').onclick = () => {
        if (!navigator.geolocation) {
          showModal('Geolocation Error', 'Geolocation is not supported by your browser.');
          return;
        }
        navigator.geolocation.getCurrentPosition(p => {
          // In a real app, this would call a geocoding API.
          // For this demo, we'll assume a hardcoded zone.
          const demoZone = '7b';
          setZone(demoZone);
          document.getElementById('error-message').classList.add('hidden');
        }, () => {
          showModal('Geolocation Error', 'Permission to access location was denied.');
        });
      };

      // Generates palettes based on a hardcoded base color
      function generatePalettes() {
        const comp = ['#2b6cb0', '#e69f00']; // blue/orange
        const analog = ['#2b6cb0', '#3b8cd1', '#1f54a0']; // blueish analogous
        const rule = ['#2b6cb0', '#68a0d9', '#f2c14e']; // dominant, secondary, accent

        const setSwatches = (id, arr) => {
          const container = document.getElementById(id);
          container.innerHTML = '';
          arr.forEach(c => {
            const d = document.createElement('div');
            d.className = 'swatch flex-1 h-12 rounded-lg';
            d.style.background = c;
            container.appendChild(d);
          });
        };
        setSwatches('comp-palette', comp);
        setSwatches('analog-palette', analog);
        setSwatches('rule-palette', rule);
      }

      // API call to suggest a new flower
      document.getElementById('generate-new-flower').onclick = async () => {
        if (!currentZone) {
          showModal('Error', 'Please enter your climate zone first.');
          return;
        }
        
        const loader = document.getElementById('new-flower-loader');
        loader.classList.remove('hidden');
        
        const prompt = `Suggest one new flower for USDA hardiness zone ${currentZone}. Focus on a plant that is either native, pollinator-friendly, or drought-tolerant. Provide the flower name, a short note, and a color. Format the response as a JSON object with keys: "name", "color", "notes". Do not include any text other than the JSON object.`;
        
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "OBJECT",
                    properties: {
                        "name": { "type": "STRING" },
                        "color": { "type": "STRING" },
                        "notes": { "type": "STRING" }
                    },
                    "propertyOrdering": ["name", "color", "notes"]
                }
            }
        };

        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // Exponential backoff for API calls
        let response;
        let delay = 1000;
        let success = false;
        const maxRetries = 5;
        let retries = 0;

        while (!success && retries < maxRetries) {
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (response.status === 429) { // Too Many Requests
                    retries++;
                    console.log(`Rate limit exceeded. Retrying in ${delay}ms...`);
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                } else if (!response.ok) {
                    throw new Error(`API response was not ok: ${response.status}`);
                } else {
                    success = true;
                }
            } catch (error) {
                console.error("Fetch failed:", error);
                retries++;
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
        }

        loader.classList.add('hidden');

        if (success && response) {
            try {
                const result = await response.json();
                const jsonString = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (jsonString) {
                  const newFlower = JSON.parse(jsonString);
                  // Add to the demo data and display
                  const newEntry = {
                    name: newFlower.name,
                    color: newFlower.color,
                    notes: newFlower.notes,
                    water: 'low', // Assuming low water for demo
                    pollinator: true, // Assuming pollinator for demo
                    native: true // Assuming native for demo
                  };

                  if (zoneFlowers[currentZone]) {
                    zoneFlowers[currentZone].push(newEntry);
                  } else {
                    zoneFlowers[currentZone] = [newEntry];
                  }
                  
                  showFlowers(currentZone);
                } else {
                  throw new Error("Invalid JSON response from API.");
                }
            } catch (error) {
                console.error("Failed to parse JSON or process data:", error);
                showModal('Error', 'Failed to generate a new flower. Please try again.');
            }
        } else {
            showModal('Error', 'Failed to reach the API after several retries. Please check your network and try again.');
        }
      };
    });
  </script>
</body>
</html>
